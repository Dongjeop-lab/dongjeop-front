import type { NextConfig } from 'next';

const nextConfig: NextConfig = {
  // =============================================================================
  // 기본 설정
  // =============================================================================

  // TypeScript 엄격 모드 (개발 생산성 향상)
  typescript: {
    // 빌드 시 타입 오류가 있어도 빌드 계속 (개발 초기에만)
    // ignoreBuildErrors: false, // 프로덕션에서는 false 권장
  },

  // ESLint 설정
  eslint: {
    // 개발 중 ESLint 오류로 빌드 중단 방지 (초기 개발시만)
    // ignoreDuringBuilds: false, // 프로덕션에서는 false 권장
  },

  // =============================================================================
  // 성능 최적화 설정
  // =============================================================================

  // Gzip 압축 (프로덕션 성능 향상)
  compress: true,

  // 이미지 최적화 설정
  images: {
    // 외부 이미지 도메인 허용 (새로운 방식)
    remotePatterns: [
      // 예시: API 서버에서 이미지 로드 시 추가
      // {
      //   protocol: 'https',
      //   hostname: 'api.dongjeop.com',
      //   pathname: '/uploads/**',
      // },
    ],

    // 이미지 포맷 최적화 (최신 포맷 우선)
    formats: ['image/webp', 'image/avif'],

    // 반응형 이미지 크기들 (모바일 최적화 중심)
    deviceSizes: [640, 750, 828, 1080, 1200, 1920],
    imageSizes: [16, 32, 48, 64, 96, 128, 256],
  },

  // =============================================================================
  // 개발 환경 최적화
  // =============================================================================

  // 개발 서버 성능 향상
  ...(process.env.NODE_ENV === 'development' && {
    // 개발 중 빠른 새로고침
    reactStrictMode: true,
  }),

  // =============================================================================
  // 배포 환경별 설정 (필요시 활성화)
  // =============================================================================

  // Docker 컨테이너 배포를 위한 standalone 모드
  output: 'standalone',

  // 정적 내보내기 설정 (필요 시 활성화)
  // output: 'export',
  // trailingSlash: true,
  // assetPrefix: process.env.NEXT_PUBLIC_CDN_URL || '',

  // =============================================================================
  // 보안 설정
  // =============================================================================

  // 보안 헤더 설정 (강화됨)
  async headers() {
    return [
      {
        source: '/(.*)',
        headers: [
          // 클릭재킹 방지
          {
            key: 'X-Frame-Options',
            value: 'DENY',
          },
          // MIME 타입 스니핑 방지
          {
            key: 'X-Content-Type-Options',
            value: 'nosniff',
          },
          // XSS 필터링
          {
            key: 'X-XSS-Protection',
            value: '1; mode=block',
          },
          // 리퍼러 정책
          {
            key: 'Referrer-Policy',
            value: 'origin-when-cross-origin',
          },
          // 권한 정책 (필요한 기능만 허용)
          {
            key: 'Permissions-Policy',
            value: 'camera=(), microphone=(), geolocation=(self)',
          },
        ],
      },
    ];
  },

  // =============================================================================
  // Next.js 15 안정화된 기능들
  // =============================================================================

  // 서버 컴포넌트 외부 패키지 지정 (안정화됨)
  serverExternalPackages: [],

  // 터보팩 설정 (안정화됨)
  turbopack: {
    rules: {
      // 필요시 커스텀 로더 규칙 추가
    },
  },

  // =============================================================================
  // 실험적 기능 (Next.js 15+)
  // =============================================================================

  experimental: {
    // PPR (부분 프리렌더링) - Next.js 15의 새 기능
    // ppr: true, // 안정화되면 활성화 고려
  },
};

export default nextConfig;
