# =============================================================================
# ğŸš€ ì¹´ì¹´ì˜¤ í´ë¼ìš°ë“œ í™˜ê²½ë³„ ë°°í¬
# 
# ğŸ¯ ë°°í¬ í™˜ê²½:
# - develop ë¸Œëœì¹˜ â†’ Dev (dev.dongjeop.com, í¬íŠ¸ 3001)
# - main ë¸Œëœì¹˜ â†’ Prod (dongjeop.com, í¬íŠ¸ 3000)
# 
# ğŸ—ï¸ êµ¬ì¡°: nginx (80/443) â†’ Next.js (3000/3001) â†’ ì¹´ì¹´ì˜¤ í´ë¼ìš°ë“œ
# ğŸ“‹ ê³¼ì •: ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬ â†’ ë¹Œë“œ â†’ SSH ë°°í¬ â†’ PM2 ì¬ì‹œì‘
#
# í™œì„±í™” ë°©ë²•:
# 1. íŒŒì¼ëª…ì„ deploy-kakao-cloud.ymlë¡œ ë³€ê²½
# 2. GitHub Secrets ì„¤ì • (ì•„ë˜ ì°¸ì¡°)  
# 3. ì£¼ì„ í•´ì œ í›„ ì»¤ë°‹ & í‘¸ì‹œ
# =============================================================================

# name: ğŸš€ ì¹´ì¹´ì˜¤ í´ë¼ìš°ë“œ ë°°í¬
# 
# on:
#   push:
#     branches: [ main, develop ]
#   workflow_dispatch:     # ìˆ˜ë™ ë°°í¬ ë²„íŠ¼
# 
# permissions:
#   contents: read
# 
# jobs:
#   deploy:
#     name: ğŸ–¥ï¸ ë°°í¬ (${{ github.ref_name }} â†’ ${{ github.ref_name == 'main' && 'Prod' || 'Dev' }})
#     runs-on: ubuntu-latest
#     timeout-minutes: 10
#     
#     steps:
#       - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
#         uses: actions/checkout@v4
# 
#       - name: ğŸŸ¢ Node.js 20 ì„¤ì •
#         uses: actions/setup-node@v4
#         with:
#           node-version: '20'
#           cache: 'npm'
# 
#       - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
#         run: npm ci
# 
#       - name: ğŸ” ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬
#         run: |
#           npm run lint
#           npm run typecheck
# 
#       - name: ğŸ—ï¸ í”„ë¡œë•ì…˜ ë¹Œë“œ
#         run: npm run build
#         env:
#           NODE_ENV: production
#           # í™˜ê²½ë³„ í™˜ê²½ë³€ìˆ˜ ì„¤ì •
#           NEXT_PUBLIC_API_URL: ${{ github.ref_name == 'main' && secrets.NEXT_PUBLIC_API_URL_PROD || secrets.NEXT_PUBLIC_API_URL_DEV }}
#           NEXT_PUBLIC_MAP_API_KEY: ${{ secrets.NEXT_PUBLIC_MAP_API_KEY }}
#           NEXT_PUBLIC_DOMAIN: ${{ github.ref_name == 'main' && secrets.NEXT_PUBLIC_DOMAIN_PROD || secrets.NEXT_PUBLIC_DOMAIN_DEV }}
# 
#       - name: ğŸš€ ì„œë²„ ë°°í¬
#         uses: appleboy/ssh-action@v1.0.3
#         with:
#           host: ${{ secrets.KAKAO_SERVER_HOST }}
#           username: ${{ secrets.KAKAO_SERVER_USER }}
#           key: ${{ secrets.KAKAO_SERVER_SSH_KEY }}
#           script: |
#             # í™˜ê²½ë³„ ì„¤ì •
#             if [ "${{ github.ref_name }}" = "main" ]; then
#               ENV_NAME="prod"
#               APP_NAME="dongjeop-prod"
#               PORT=3000
#               WORK_DIR="/var/www/dongjeop-front/prod"
#             else
#               ENV_NAME="dev"
#               APP_NAME="dongjeop-dev"
#               PORT=3001
#               WORK_DIR="/var/www/dongjeop-front/dev"
#             fi
#             
#             echo "ğŸš€ Starting $ENV_NAME deployment..."
#             
#             # ì‘ì—… ë””ë ‰í† ë¦¬ë¡œ ì´ë™ (ì—†ìœ¼ë©´ ìƒì„±)
#             sudo mkdir -p $WORK_DIR
#             sudo chown -R $USER:$USER $WORK_DIR
#             cd $WORK_DIR
#             
#             # ìµœì‹  ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
#             if [ -d ".git" ]; then
#               git pull origin ${{ github.ref_name }}
#             else
#               git clone https://github.com/Dongjeop-lab/dongjeop-front.git .
#               git checkout ${{ github.ref_name }}
#             fi
#             
#             # ì˜ì¡´ì„± ì—…ë°ì´íŠ¸ ë° ë¹Œë“œ  
#             npm ci
#             npm run build
#             
#             # PM2ë¡œ ì„œë²„ ì¬ì‹œì‘
#             pm2 restart $APP_NAME || pm2 start npm --name "$APP_NAME" -- start
#             
#             # í—¬ìŠ¤ì²´í¬
#             sleep 5
#             curl -f http://localhost:$PORT || exit 1
#             
#             echo "âœ… $ENV_NAME ë°°í¬ ì™„ë£Œ!"

# =============================================================================
# ğŸ“‹ GitHub Secrets ì„¤ì • (7ê°œ)
# ê²½ë¡œ: GitHub ì €ì¥ì†Œ â†’ Settings â†’ Secrets and variables â†’ Actions â†’ New secret
# =============================================================================

# ğŸ–¥ï¸ ì„œë²„ ì •ë³´ (ê³µí†µ):
# KAKAO_SERVER_HOST=123.45.67.89 (ì¹´ì¹´ì˜¤ í´ë¼ìš°ë“œ ì„œë²„ IP)
# KAKAO_SERVER_USER=ubuntu
# KAKAO_SERVER_SSH_KEY=-----BEGIN OPENSSH PRIVATE KEY----- (SSH ê°œì¸í‚¤)

# ğŸŒ Prod í™˜ê²½ë³€ìˆ˜:
# NEXT_PUBLIC_API_URL_PROD=https://api.dongjeop.com 
# NEXT_PUBLIC_DOMAIN_PROD=dongjeop.com

# ğŸ§ª Dev í™˜ê²½ë³€ìˆ˜:
# NEXT_PUBLIC_API_URL_DEV=https://dev-api.dongjeop.com
# NEXT_PUBLIC_DOMAIN_DEV=dev.dongjeop.com

# ğŸ—ºï¸ ê³µí†µ í™˜ê²½ë³€ìˆ˜:
# NEXT_PUBLIC_MAP_API_KEY=your-map-api-key (ì§€ë„ API í‚¤)

# =============================================================================
# ğŸš€ ì‚¬ìš© ë°©ë²•
# =============================================================================

# 1ë‹¨ê³„: ì„œë²„ ì¤€ë¹„
# - README-DEPLOYMENT.md ê°€ì´ë“œì— ë”°ë¼ ì„œë²„ ì„¤ì • ì™„ë£Œ
# - nginx ì„¤ì •ì—ì„œ prod(3000), dev(3001) í¬íŠ¸ ì„¤ì •
# - ì„œë²„ì— í™˜ê²½ë³„ ë””ë ‰í† ë¦¬ ìƒì„±:
#   sudo mkdir -p /var/www/dongjeop-front/{prod,dev}
#   sudo chown -R ubuntu:ubuntu /var/www/dongjeop-front

# 2ë‹¨ê³„: ì›Œí¬í”Œë¡œìš° í™œì„±í™”  
# - ì´ íŒŒì¼ëª…ì„ deploy-kakao-cloud.ymlë¡œ ë³€ê²½
# - ìœ„ì˜ GitHub Secrets ì„¤ì • (7ê°œ)
# - ì£¼ì„ í•´ì œ í›„ ì»¤ë°‹

# 3ë‹¨ê³„: ë°°í¬ ì‹¤í–‰
# - develop ë¸Œëœì¹˜ push â†’ dev ìë™ ë°°í¬ (í¬íŠ¸ 3001)
# - main ë¸Œëœì¹˜ push â†’ prod ìë™ ë°°í¬ (í¬íŠ¸ 3000)
# - ë˜ëŠ” GitHub Actions íƒ­ì—ì„œ ìˆ˜ë™ ì‹¤í–‰

# âš ï¸ ì£¼ì˜: 
# - nginx ì„¤ì •ì—ì„œ dev.dongjeop.com â†’ 3001, dongjeop.com â†’ 3000 í¬íŠ¸ ì„¤ì • í•„ìš”
# - ìì„¸í•œ nginx ì„¤ì •ë²•ì€ README-DEPLOYMENT.md ì°¸ì¡°