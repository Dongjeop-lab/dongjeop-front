name: ðŸ” ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬

on:
  push:
    branches: [ main, develop ]
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write    # PR ëŒ“ê¸€ ê¶Œí•œ
  checks: write          # ì²´í¬ ìƒíƒœ ì—…ë°ì´íŠ¸ ê¶Œí•œ

jobs:
  ci:
    name: ðŸ“‹ í’ˆì§ˆ ê²€ì‚¬
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
      - name: ðŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ðŸŸ¢ Node.js 22 ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: '22'
          cache: 'npm'

      - name: ðŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜ ë° í’ˆì§ˆ ê²€ì‚¬
        run: |
          npm ci
          npm run ci
        env:
          # Next.js ë¹Œë“œ ìµœì í™” (ë©”ëª¨ë¦¬ ë¶€ì¡± ë°©ì§€)
          NODE_OPTIONS: --max-old-space-size=4096
          # API URL (ë¹Œë“œ ì‹œ í•„ìš”)
          NEXT_PUBLIC_API_URL: http://61.109.238.45:8082

      - name: ðŸ“Š ê²€ì‚¬ ê²°ê³¼ ìš”ì•½
        if: always()
        run: |
          echo "## ðŸ” í’ˆì§ˆ ê²€ì‚¬ ì™„ë£Œ" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬ í†µê³¼ (lint + typecheck + build)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Node.js:** $(node --version)" >> $GITHUB_STEP_SUMMARY
          echo "**Next.js:** $(npx next --version)" >> $GITHUB_STEP_SUMMARY
